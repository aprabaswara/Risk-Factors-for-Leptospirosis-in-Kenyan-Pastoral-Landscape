---
output: 
  bookdown::pdf_document2
toc: false
number_sections: true

documentclass: article
classoption:
  - twoside
  - 11pt
fontsize: 11pt
header-includes:
- \usepackage{siunitx,mathcomp}
- \usepackage{subfig}
- \usepackage{geometry}
- \usepackage{enumerate}
- \usepackage{latexsym,booktabs}
- \usepackage{amsmath,amssymb}
- \usepackage{graphicx}
- \usepackage{hyperref}
- \usepackage[singlespacing]{setspace}
- \usepackage{calc}
- \geometry{a4paper,left=2cm,right=2.0cm, top=2cm, bottom=2.0cm}
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \floatplacement{figure}{H}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable} 
- \usepackage{threeparttablex} 
- \usepackage[normalem]{ulem} 
- \usepackage{makecell}
- \usepackage{xcolor}
- \newtheorem{Definition}{Definition}
- \newtheorem{Theorem}{Theorem}
- \newtheorem{Lemma}{Lemma}
- \newtheorem{Corollary}{Corollary}
- \newtheorem{Proposition}{Proposition}
- \newtheorem{Algorithm}{Algorithm}
- \numberwithin{Theorem}{section}
- \numberwithin{Definition}{section}
- \numberwithin{Lemma}{section}
- \numberwithin{Algorithm}{section}
- \numberwithin{equation}{section}
- \newcommand{\dottedline}[1]{\makebox[#1]{.\dotfill}}
---

```{r setup, message = FALSE, warning = FALSE, include=FALSE}
library(tidyverse)
library(knitr)
if (!require("kableExtra"))
{
  install.packages("kableExtra")
  library(kableExtra)
}
knitr::opts_chunk$set(echo = TRUE)
print.all.code=FALSE
#Setting this TRUE will include all code chunks in the PDF
```

```{=latex}
\pagestyle{empty}

% =============================================================================
% Title page
% =============================================================================
\begin{titlepage}
\vspace*{.5em}
\center
\textbf{\Large{The School of Mathematics}} \\
\vspace*{1em}
\begin{figure}[!h]
\centering
\includegraphics[width=180pt]{CentredLogoCMYK.jpg}
\end{figure}
\vspace{2em}
\textbf{\Huge{Risk Factors for Leptospirosis Infection in a Kenyan Pastoral Landscape}}\\[2em]
\textbf{\LARGE{by}}\\
\vspace{2em}
\textbf{\LARGE{Aditya Prabaswara Mardjikoen, s2264710}}\\
\vspace{6.5em}
\Large{Dissertation Presented for the Degree of\\
MSc in Statistics with Data Science}\\
\vspace{6.5em}
\Large{July 2022}\\
\vspace{3em}
\Large{Supervised by\\Dr Gail Robertson and Dr Amy Wilson}
\vfill
\end{titlepage}

\cleardoublepage

% =============================================================================
% Executive summary, acknowledgments, and own work declaration
% =============================================================================
\begin{center}
\Large{Executive Summary}
\end{center}
Due to the enormous impact an infection can have on human and animal morbidity and death, leptospirosis has been classified as a disease of worldwide public health importance \cite{goarant2016}. These epidemics have increased in frequency during the past few decades, especially in developing nations \cite{Soo2020}. In particular, numerous studies have shown that this zoonotic illness is becoming more common due to various factors, but little has been done to pinpoint individual who are most at risk, particularly in low-income rural areas of developing nations. As a result, the purpose of this report will be to identify individual risk factors for leptospirosis infections in a Kenyan rural area.
\par
We used the International Livestock Research Institute data on household members at villages in Tana River County, Kenya, who undergo ELISA(enzyme-linked immunosorbent assay) test in 2013 and 2014. The main methods we employed in this reports are Binomial generalized linear mixed model (GLMM) \cite{zuur2009} and Odds Ratio (OR) \cite{jewell2003}. We discover that individual risk factors for leptospirosis infections include increasing age, female gender, living in a large family, living or having contact with their household head who works as a pastoralist, living in a lower-altitude village, and living or having contact with a younger household head.
\clearpage

\begin{center}
\Large{Acknowledgments}
\end{center}

I am grateful to the supervisors of this project, Dr Gail Robertson and Dr Amy Wilson, for their support and valuable advice. I would also like to thank Bernard Bett and the International Livestock Research Institute for providing the background material and data for this project.

\clearpage

\begin{center}
\Large{University of Edinburgh â€“ Own Work Declaration}
\end{center}


%This sheet must be filled in, signed and dated - your work will not be marked unless this is done.
% Replace the commands \dottedline{8cm}, %\dottedline{6cm}, etc. with you name, Matriculation 
% Number, etc.
\vspace{1cm}

Name: Aditya Prabaswara Mardjikoen %\dottedline{8cm}

Matriculation Number: s2264710 %\dottedline{6cm}

Title of work: Risk Factors for Leptospirosis Infection in a Kenyan Pastoral Landscape %\dottedline{8cm}

\vspace{1cm}

I confirm that all this work is my own except where indicated, and that I have:
\begin{itemize}
\item   Clearly referenced/listed all sources as appropriate                    
\item   Referenced and put in inverted commas all quoted text (from books, web, etc)    
\item   Given the sources of all pictures, data etc. that are not my own                
\item   Not made any use of the report(s) or essay(s) of any other student(s) either past   
or present  
\item   Not sought or used the help of any external professional academic agencies for the work
\item   Acknowledged in appropriate places any help that I have received from others    (e.g. fellow students, technicians, statisticians, external sources)
\item   Complied with any other plagiarism criteria specified in the Course handbook
\end{itemize}

I understand that any false claim for this work will be penalised in accordance with
the University regulations  (\url{https://teaching.maths.ed.ac.uk/main/msc-students/msc-programmes/statistics/data-science/assessment/academic-misconduct}).                                

\vspace{1cm}

\includegraphics[width=0.5\textwidth]{signature.png}
%Signature \dottedline{8cm}

%Include your signature as an image with the
%\includegraphics command 
%(see an example later in the document)

\vspace{5mm}

Edinburgh, 29 July 2022%Date \dottedline{8cm}


\clearpage



% =============================================================================
% Table of contents, tables, and pictures (if applicable)
% =============================================================================
\pagestyle{plain}
\setcounter{page}{1}
\pagenumbering{Roman}
\tableofcontents
\clearpage
\listoftables
\listoffigures
\cleardoublepage

\pagenumbering{arabic}
\setcounter{page}{1}

\nocite{*}
\bibliographystyle{abbrv}
\clearpage
```
```{=latex}
\section{Introduction}
\label{sec:intro}
\setlength{\parindent}{20pt}
\subsection{Background and Motivation}
\label{sec: background}
Leptospirosis is a neglected but re-emerging zoonotic disease which has been identified as a disease of global public health importance due to the significant effect infection can have on human and animal morbidity and mortality \cite{goarant2016}. Acute fever of unknown cause is the disease's most early sign. \textit{Leptospira} is the most typical bacterium that causes this illness \cite{Soo2020}. It is a water-borne bacteria that can cause febrile illness with a chance of serious complications if it is left untreated. 
\par
Over the past few decades, leptospirosis outbreaks have become more frequent, especially in developing nations \cite{Soo2020}. While outbreaks are often reported in urban areas after flooding events, rural communities are highly vulnerable to leptospirosis outbreaks due to possible risk factors such as outdoor working, contact with animals, and poor sanitation. Various studies have documented a rise in the incidence of this zoonotic infection due to various factors including climate change \cite{lau2010}, but less work has been done on identifying individuals at risk, especially in low-income rural areas in developing countries. Therefore, it is important to understand and identify individual risk factor of leptospirosis in order to reduce the disease transmission rate.

\subsection{Objective}
\label{sec: objective}
The goals of this report is to identify individual risk factors for leptospirosis infection in a rural area of Kenya. 

\subsection{Literature Review}
\label{sec: review}
We now give a brief review regarding the literature about risk factors of leptospirosis. The earliest study we consider is \cite{lau2010}. They find that climate change, flooding, population growth and urbanisation can lead to an escalation of leptospirosis outbreaks. Another study conducted by \cite{goarant2016} suggest that leptospirosis is an occupational disease associated with freshwater or animal exposure.
\par
Some study, such as \cite{cook357}, manage to identify individual risk factors of leptospirosis in western Kenya, however, they only consider individual that belongs into slaughterhouse workers group. They discover that personal hygiene factor appear to have the most influence on the risk of leptospirosis transmission. Over the past few years, study conducted by \cite{Soo2020} discover that rats is the primary reservoir of leptospirosis. In this report, we will use some methods in \cite{cook357} to identify individual risk factors for leptospirosis in rural area of Kenya.
\subsection{Data}
\label{sec:data}
The International Livestock Research Institute tested household members for leptospirosis using ELISA (enzyme-linked immunosorbent assay) in 2013 and 2014 in villages in Tana River County, Kenya, and recorded the results in the data used for this report. Each observation in the data represents a leptospirosis test result from one sample taken from a person on a given date from a specific household. Additionally, questionnaire responses from test subjects are documented. It contains demographic data (age and sex) as well as information about the respondent's and their head of household's behaviours. 
\par
The location of the respondent's residence as well as details about their work and animal contact behaviour are also gathered. Besides that, we also have data regarding village altitude (measured in metres) and hospital distance (measured in kilometres). The hospital distance is calculated from the household to the local hospital, whereas the village altitude is recorded via GPS.

%Particularly Section \ref{sec:methods} is good!
%\clearpage
\clearpage
```
```{=latex}
\section{Exploratory Data Analysis and Data Preparation}
\label{sec: eda}

\subsection{Missing Data Analysis}
\label{sec: ida}
We discover that there exist 12 duplicated observations in the data and remove them. Figure \ref{fig:lepto-na}  (see Appendix \ref{app:one} for acronyms descriptions) show that around 36\% of the data was missing, primarily the occupation of the person sampled from a specific household. Overall, there are around 48\% observations with missing data. 
```
```{r lepto-na, message=FALSE, warning=FALSE, echo=FALSE,fig.width=7,fig.height=8,fig.cap = "Proportion of missing data in each variable of interest and patterns of missing data."}
# Loading required library and defined required function
library(lme4)
library(gtsummary)
library(tidyverse)
library(readxl)
library(ggpubr)
library(patchwork)
library(data.table)
library(naniar)
library(JointAI)
library(arm)

prevalence_plot <- function(dat,...){
  # Function to display bar plot prevalence based on category
  # Input: dat = data, ... = variable to categorize the prevalence
  # Output: bar plot of prevalence by category
  
  # Compute prevalence based on input category
  df <- dat %>%  group_by(...) %>% 
    dplyr::summarise(Prevalence = 100*sum(result=="Positive")/n()) %>%
    na.omit()
  df <- data.table(df)
  
  # Plot prevalence based on input category
  p <- ggplot(data=df, aes(x=..., y=Prevalence))
  p <- p+geom_bar(stat="identity")
  p <- p+ylab("Leptospirosis Prevalence (%)")+theme_classic()
  
  return(p)
}

# Read data
leptospirosis.dt <- read_excel("Leptospirosis data for MSc SWDS.xlsx")
leptospirosis.dt <- data.table(leptospirosis.dt)


# Remove duplicated rows
leptospirosis.dt <- leptospirosis.dt %>% distinct()

# Find occupations above or 20 worker
rare_job <- names(which(table(leptospirosis.dt$occupation)<20))
job_index <- which(!leptospirosis.dt$occupation %in% rare_job)

# Find locations above or 20 residents
rare_loc <- names(which(table(leptospirosis.dt$location)<20))
loc_index <- which(!leptospirosis.dt$location %in% rare_loc)

# Find villages above or 20 residents
rare_vil <- names(which(table(leptospirosis.dt$village)<20))
vil_index <- which(!leptospirosis.dt$village %in% rare_vil)

# Plot percentage of missing data in each variable and missing data pattern
p1 <- gg_miss_var(leptospirosis.dt,show_pct=TRUE)+theme_classic()

p2 <- md_pattern(leptospirosis.dt, pattern = FALSE, color = c('#34111b', '#e30f41'))

p1/p2
```

```{=latex}
\subsection{ELISA Test Result Analysis}
\label{sec: result distribution}
We start by looking at the descriptive statistics for the ELISA results for the leptospirosis test. Figure \ref{fig:lepto-result} displays the proportions of participants who underwent this immunological assay and were exposed to leptospirosis compared to those who were not. The findings of the ELISA test show that leptospirosis was detected in around 26\% of the participants.
```
```{r lepto-result, message=FALSE, warning=FALSE, echo=FALSE,fig.height=7,fig.cap = "Proportion of person from specific household in villages in Tana River County, Kenya who exposed and not exposed to leptospirosis according to ELISA test result."}

# Create age categories factor variable
leptospirosis.dt <- leptospirosis.dt %>%  mutate(
  age_group = dplyr::case_when(
    age <= 9            ~ "0-9",
    age > 9 & age <= 19 ~ "10-19",
    age > 19 & age <= 29 ~ "20-29",
    age > 29 & age <= 39 ~ "30-39",
    age > 39 & age <= 49 ~ "40-49",
    age > 49 & age <= 59 ~ "50-59",
    age > 59 & age <= 69 ~ "60-69",
    age > 69 & age <= 79 ~ "70-79",
    age >= 80            ~ "80+",
  ))

leptospirosis.dt$age_group <- factor(leptospirosis.dt$age_group)

# ELISA test result distribution
ggplot(leptospirosis.dt, aes(x=result,fill=result))+
  geom_bar(aes(y = 100*(..count..)/sum(..count..)))+ xlab("ELISA Test Result")+
  ylab("Proportion of Leptospirosis Cases (%)")+ theme_classic()+
  theme(legend.position="none",plot.title = element_text(hjust = 0.5))+
  ggtitle("Proportion of Leptospirosis Cases Based on ELISA Test Results")
```

```{=latex}
\subsection{Leptospirosis Prevalence Based on Demographic Profile}
\label{sec: demographic profile}

Prevalence \cite{jewell2003} is the proportion of a particular population found to be affected by a disease at a certain time. Because the data was collected between 2013 and 2014, we define the prevalence of leptospirosis cases as the proportion of a population in rural area of Kenya that tested positive for leptospirosis using ELISA between those years.
\par
We started by investigating the number of worker at each occupation that was sampled in the data. Figure \ref{fig:job-kenya} depicts that most individual in the data worked as a pastoralist. We decided not calculating the prevalence of leptospirosis cases for jobs with less than 20 workers sampled in the data since doing so would have indicated that certain of those occupations had a larger prevalence of leptospirosis cases than other occupations in the data.
```
```{r job-kenya, echo = FALSE, warning = FALSE, message = FALSE, fig.width=7, fig.height=8,fig.cap="Number of individuals in the data based on their occupations."}
# Occupation distribution
leptospirosis.dt %>% filter(!is.na(occupation)) %>% 
  ggplot(aes(x=occupation,fill=occupation))+geom_bar(aes(y = (..count..)))+
  geom_text(stat='count', aes(label=..count..),vjust=-1)+ 
  xlab("Occupation")+
  ylab("Number of Employees")+theme_classic()+
  theme(legend.position="none",plot.title=element_text(hjust=0.5))+
  ggtitle("Kenyan ELISA Test Participant Employment Status")+
  guides(x = guide_axis(angle = 90)) 
```

```{=latex}
We explore the prevalence of leptospirosis cases based on demographic profile (age, gender and occupation). Figure \ref{fig:demo-profile} illustrates the prevalence of leptospirosis cases in settlements in Tana River County, Kenya based on the individuals demographic profile. According to the upper left plot, people between the ages of 20 and 49 are most commonly succumb to leptospirosis (the prevalence is around 33.3\%). It appears that females are most frequently infected with leptospirosis, as we can see on the upper right plot (the prevalence is around 29\%). The lower plot indicates that the majority of leptospirosis cases occur among people who work as pastoralists (the prevalence is around 30\%).
```
```{r demo-profile, echo = FALSE, message = FALSE, warning = FALSE, fig.width=9,fig.height=11, fig.cap = "Leptospirosis prevalence based on age, gender and occupation (with above or 20 worker sampled in the data)."}
# Plot prevalence by age, gender and occupation
p3 <- prevalence_plot(leptospirosis.dt,age_group)+xlab("Age")
p4 <- prevalence_plot(leptospirosis.dt,gender)+xlab("Sex")
p5 <- prevalence_plot(leptospirosis.dt[job_index,],occupation)+xlab("Occupation")

(p3+p4)/p5
```

```{=latex}
\subsection{Leptospirosis Prevalence Based on Livestock Ownership and Geographical Location}
\label{sec: livestock ownership and geographical location}
We explore the prevalence of leptopspirosis cases based on the existence of livestock in the household of the sampled persons and sampling site characterization based on land use. Figure \ref{fig:livestk} illustrates that leptospirosis cases are most likely to occured at an individual who kept livestock in the household (the prevalence is around 23\%). Moreover, we also discover that leptospirosis cases are most likely to take place in pastoral land use (the prevalence is around 31\%).
```
```{r livestk, echo = FALSE, message = FALSE, warning = FALSE,fig.width=6,fig.height=8,fig.cap = "Leptospirosis prevalence based on livestock existence at household and sampling site characterization based on land use."}
# Plot prevalence by livestock existence at home and land use
p7 <- prevalence_plot(leptospirosis.dt,livestk_home)+xlab("Livestock at Home")
p8 <- prevalence_plot(leptospirosis.dt,landuse)+xlab("Land Use")
p7/p8
```

```{=latex}
Next, we explore the prevalence of leptospirosis cases based on constituency, village altitudes and hospital distances. Figure \ref{fig:constituent-plot} illustrates that leptospirosis cases are most likely to occur in Ijara (the prevalence is around 40\%). Moreover, leptospirosis cases are more common in villages with an altitude of 50 metres or less (the prevalence is around 42\%). Furthermore, leptospirosis cases are more frequent in an area with a distance from household to local hospital of between 22 and 32 kilometres (the prevalence is around 32\%).
```
```{r constituent-plot, echo = FALSE, warning = FALSE, message =FALSE, fig.width=7, fig.height=8,fig.cap = "Leptospirosis prevalence based on constituency, village altitude and hospital distance."}
# Create altitude categories factor variable
leptospirosis.dt <- leptospirosis.dt %>%  mutate(
  altitude_group = dplyr::case_when(
    altitude <= 49            ~ "0-50",
    altitude > 49 & altitude <= 99 ~ "51-101",
    altitude > 99                  ~ "102+",
  ))

leptospirosis.dt$altitude_group <- factor(leptospirosis.dt$altitude_group)
levels(leptospirosis.dt$altitude_group) <- c("0-50","51-101","102+")

# Create hospital distance categories factor variable
leptospirosis.dt <- leptospirosis.dt %>%  mutate(
  disthosp_group = dplyr::case_when(
    disthosp <= 10            ~ "0-10",
    disthosp > 10 & disthosp <= 21 ~ "11-21",
    disthosp > 21 & disthosp <= 32 ~ "22-32",
    disthosp > 32                  ~ "33+"
  ))

leptospirosis.dt$disthosp_group <- factor(leptospirosis.dt$disthosp_group)
levels(leptospirosis.dt$disthosp_group) <- c("0-10","11-21","22-32","33+")

# Plot prevalence by constituency, altitude and hospital distance
p11 <- prevalence_plot(leptospirosis.dt,constituency)+xlab("Constituency")
p12 <- prevalence_plot(leptospirosis.dt,altitude_group)
p12 <- p12+xlab("Village Altitude (metres)")
p13 <- prevalence_plot(leptospirosis.dt,disthosp_group)
p13 <- p13+xlab("Hospital Distance (kilometres)")
(p12+p13)/p11
```

```{=latex}
Lastly, we investigate the prevalence of leptospirosis cases based on location and village. Figure \ref{fig:viltab} illustrates that the individual in the data is most likely sampled from village 12. Additionally, it appears that sampling is most frequently done in location 3. We opted not to compute the prevalence of leptospirosis cases for locations and villages with fewer than 20 individuals sampled in the data since doing so would have shown that specific locations and villages had a higher prevalence of leptospirosis cases than other locations and villages in the data.
```
```{r viltab, echo=FALSE, message=FALSE, warning=FALSE, fig.width=9,fig.height=12,fig.cap="Number of individuals in the data based on villages and locations."}
# Village and location distribution
p14 <- leptospirosis.dt %>% filter(!is.na(village)) %>% 
    ggplot(aes(x=village,fill=village))+geom_bar(aes(y = (..count..)))+
    geom_text(stat='count', aes(label=..count..),vjust=-1)+ 
    xlab("")+
    ylab("Number of Participants")+theme_classic()+
    theme(legend.position="none",plot.title=element_text(hjust=0.5))+
    ggtitle("Kenyan ELISA Test Participants Based on Villages")+
    guides(x = guide_axis(angle = 90)) 

p15 <- leptospirosis.dt %>% filter(!is.na(location)) %>% 
    ggplot(aes(x=location,fill=location))+geom_bar(aes(y = (..count..)))+
    geom_text(stat='count', aes(label=..count..),vjust=-1)+ 
    xlab("")+
    ylab("Number of Participants")+theme_classic()+
    theme(legend.position="none",plot.title=element_text(hjust=0.5))+
    ggtitle("Kenyan ELISA Test Participants Based on Locations")+
    guides(x = guide_axis(angle = 90)) 

p14/p15
```

```{=latex}
Figure \ref{fig:loc-vil} illustrates that leptospirosis cases are most likely to occured at village 25 (the prevalence is around 59\%). It appears that leptospirosis cases are most likely to appeared in location 1 (the prevalence is around 62.5\%).
```
```{r loc-vil, echo = FALSE, message = FALSE, warning = FALSE, fig.width=9, fig.height=11, fig.cap = "Leptospirosis prevalence based on location and village with above or 20 individuals sampled in the data."}
# Plot prevalence by location and village
p9 <- prevalence_plot(leptospirosis.dt[loc_index,],location)+xlab("")+guides(x = guide_axis(angle = 90)) 

p10 <- prevalence_plot(leptospirosis.dt[vil_index,],village)+xlab("")+guides(x = guide_axis(angle = 90)) 

p9/p10
```

```{=latex}
\subsection{Leptospirosis Prevalence Based on Household Head Occupation}
\label{sec: household head occupation}
Figure \ref{fig:hhoccup-result} depicts that most household head works as a pastoralist. We decided not calculating the prevalence of leptospirosis cases for household headjobs with less than 20 household head works in these occupations since doing so would have indicated that certain of those household head occupations had a larger prevalence of leptospirosis cases than other household occupations in the data. According to Figure \ref{fig:hhoccup-prev}, leptospirosis cases is most likely to occur at an individual where their household head works as a pastoralist (the prevalence is around 32\%).
```
```{r hhoccup-result, message=FALSE, warning=FALSE, echo=FALSE,fig.height=7,fig.cap = "The number of household heads who work in the given household head occupation in the data."}
# Household head occupation distribution
leptospirosis.dt %>% filter(!is.na(hhoccup)) %>% 
  ggplot(aes(x=hhoccup,fill=hhoccup))+geom_bar(aes(y = (..count..)))+
  geom_text(stat='count', aes(label=..count..),vjust=-1)+ 
  xlab("Household Head Occupation")+
  ylab("Number of Household Head")+theme_classic()+
  theme(legend.position="none",plot.title=element_text(hjust=0.5))+
  ggtitle("Kenyan Household Head Employment Status")+
  guides(x = guide_axis(angle = 90))
```

```{r hhoccup-prev, message=FALSE, warning=FALSE, echo=FALSE,fig.height=7,fig.cap = "Leptospirosis prevalence based on household head occupation with above or 20 household  head works in that occupation in the data."}
# Find household head occupation with 20 worker or above
rare_hhjob <- names(which(table(leptospirosis.dt$hhoccup)<20))
hhjob_index <- which(!leptospirosis.dt$hhoccup %in% rare_hhjob)

# Plot prevalence basd on household head occupation
prevalence_plot(leptospirosis.dt[hhjob_index,],hhoccup)+xlab("Household Head Occupation")
```

```{=latex}
\clearpage
```
```{=latex}
\section{Models}
\label{sec:methods}
\setlength{\parindent}{20pt}

\subsection{Fixed and Random Effects}
\label{sec: effects}
Mixed effects model or mixed model is a regression models that contain both fixed and random effects \cite{faraway2016}. An example of this model is discussed in Section \ref{sec: glmm}. We define effects (or coefficients) in the mixed effects model as constant if they are similar for all groups in a population and varying if they are possible to vary between groups to groups \cite{gelman2005}. For instance, the model $y_{ij}=\alpha_{j}+\beta x_{ij}+\epsilon_{ij}$ (of the $i$th observations in groups $j$) has a constant slope and varying intercept, and $y_{ij}=\alpha_{j}+\beta_{j} x_{ij}+\epsilon_{ij}$ has a varying slope and intercept. 
\par
Fixed effects are effects in which the population elements are fixed, whereas random effects are effects in which the population elements can change \cite{gelman2005}. Thus, we can consider random effects as a random variables \cite{faraway2016}. The distinguishing feature of fixed and random effects is that fixed effects assumed that observations are independent, whereas random effects presume that some observations have a relationship \cite{gelman2005}. For instance, gender is a fixed effect variable since the only conceivable values of that variable are males and females, and those values are independent of one another. A study on food pricing at restaurants in different locations can consider location as a random effects because prices can vary depending on location.

\subsection{Generalized Linear Mixed Model}
\label{sec: glmm}
Generalized linear mixed model (GLMM) is a generalized linear model (GLM) with random effects terms \cite{faraway2016}. In matrix form, we can formulate this model as follows:
\begin{equation*}
\boldsymbol\eta=g(E[\mathbf{y}])=\mathbf{X}\boldsymbol\beta+\mathbf{Z}\boldsymbol\gamma
\end{equation*}
where $\mathbf{X}$ is the design matrix for the fixed effects observations (predictors), $\boldsymbol\beta$ is the fixed effects coefficients column vectors, $\mathbf{Z}$ is the design matrix for the random effects observations, $\boldsymbol\gamma$ is the random effects, $\boldsymbol\eta$ is the linear predictors column vectors, and $\mathbf{y}$ is the column vector of response variables with mean $E[\mathbf{y}]$. The link function $g(\cdot)$ relates the outcome $\mathbf{y}$ with the linear predictors $\boldsymbol\eta$. Table \ref{Tab:link} provide some examples of link functions based on the distribution of the response variables.
\begin{table}[ht]
\centering
\caption{Link functions for GLM \cite{faraway2016}.}
\begin{tabular}[t]{lcc}
\hline
Family&Link Function\\
\hline
Normal& $g(\mu)=\mu$\\
Poisson& $g(\mu)=\log{\mu}$\\
Binomial& $g(\mu)=\log{\left(\dfrac{\mu}{1-\mu}\right)}$\\
Gamma& $g(\mu)=\mu^{-1}$\\
Inverse Gaussian& $g(\mu)=\mu^{-2}$\\
\hline
\label{Tab:link}
\end{tabular}
\end{table}

\subsection{Modelling Considerations}
\label{sec: considerations}
After analysing our data in Section \ref{sec: eda}, we decided not to include occupation, presence of livestock at home, location and hospital distance because these variables contain 30\% or more missing data, which would cause some variables that should have a significant effect on leptospirosis infection to become insignificant because we reduced around 48\% of the data if we include these variables. As a result, we decide to consider the occupation of the household head instead, because this variable is the only variable related with occupations which is fully-observed and leptospirosis can occur through human-to-human transmission \cite{goarant2016}. 
\par
We decide to omit observations where the household head occupation had fewer than 20 household head as the workers recorded in the data, as keeping these observations before fitting our mixed effects model would increase the uncertainty of the estimated and true risk of leptospirosis infections in people who live with the household head that works in these occupations and grouping these occupations is difficult due to some occupation have different characteristic with others. Thus, we only consider two type of household head occupation in our model: farmer and pastoralist. Due to we only consider this two types of household head occupation, we treat this variable as a fixed effects variable.
\par
According to \cite{lau2010}, the frequency of leptospirosis patients varies significantly by region due to factors including climate and environmental change. Thus, we would consider village, household and constituency as a random effects in our model. However, we will treat land use as a fixed effects variable since we only consider 3 land use in this report: irrigation, pastoral and riverine. As for gender, it is a fixed effects variables based on explanation in Section \ref{sec: effects}.

\subsection{Leptospirosis Test Results Prediction Model}
\label{sec: leptospirosis model}
In this report, we used a Binomial GLMM \cite{zuur2009} model since the response variable is a binary variable (takes only two values, in this case, negative and positive test results) and it enables us to account for both hierarchical data structures and correlations between observations (such as geographical correlations). Let $Y_{ijk}$ be the ELISA test results for person $i$ at village $j$ and household $k$. $Y_{ijk}$ is 1 if the ELISA test results for person $i$ from village $j$ and household $k$ is positive and 0 if negative. We denoted $p_{ijk}$ as the probability that person $i$ from village $j$ and household $k$ is tested positive for leptospirosis. The Binomial GLMM model that we will used in this report is formulated as follows:
\begin{equation} \label{eq:1}
\begin{split}
Y_{ijk} &\sim \text{Bernoulli}\left(p_{ijk}\right)\\
\log{\left(\dfrac{p_{ijk}}{1-p_{ijk}}\right)}&=\alpha+\beta_1\textrm{Age}_{ijk}+\beta_2\textrm{Altitude}_{ijk}+\beta_3\textrm{Gender}_{ijk}\\
&+\beta_4\textrm{HHOccupationPastoralist}_{ijk}
+\beta_5\textrm{HHAge}_{ijk}+\beta_6\textrm{FamilySize}_{ijk}\\
&+\beta_7\textrm{LandusePastoral}_{ijk}+\beta_8\textrm{LanduseRiverine}_{ijk}
+\gamma_j+\lambda_k\\
\gamma_j&\sim \textrm{N}(0,\sigma^2_{\gamma})\\
\lambda_k&\sim \textrm{N}(0,\sigma^2_{\lambda})
\end{split}
\end{equation}

where:
\begin{itemize}
\item $\textrm{Age}_{ijk}$ is the sampled person age; 
\item $\textrm{Gender}_{ijk}$ is the sampled person gender (1 = female and 0 = male); 
\item $\textrm{Altitude}_{ijk}$ is the altitude of the village where the person was sampled;
\item $\textrm{HHOccupationPastoralist}_{ijk}$ is 1 if person $i$ from village $j$ and household $k$ live with household head with occupation as a pastoralist and 0 if the household head work as a farmer; 
\item $\textrm{HHAge}_{ijk}$ is the household head age in household $k$; 
\item $\textrm{FamilySize}_{ijk}$ is the number of family member who lived in household $k$;
\item $\textrm{LandusePastoral}_{ijk}$ is 1 if person $i$ from village $j$ and household $k$ was sampled in pastoral land use and 0 if otherwise;
\item $\textrm{LanduseRiverine}_{ijk}$ is 1 if person $i$ from village $j$ and household $k$ was sampled in riverine land use and 0 if otherwise.
\end{itemize}

Model \eqref{eq:1} is an example of logistic regression model \cite{jewell2003}. We assume that $Y_{ijk}$ has a Bernoulli (single-trial Binomial) distribution with probability $p_{ijk}$. $\gamma_j$ is the random effect for villages and is assumed to be normally distributed with mean 0 and variance $\sigma^2_{\gamma}$. As for $\lambda_k$, it is the random effect for households and is assumed to be normally distributed with mean 0 and variance $\sigma^2_{\lambda}$. The parameter $\alpha$ and $\beta_i$ in Model \eqref{eq:1} represents the fixed effects intercept and slope respectively.

\subsection{Odds Ratio}
\label{sec: odds ratio}
We define the odds \cite{jewell2003} of outcome $D$ as
the probability of $D$ will occur divided by the probability that it will not occur. The Odds Ratio (OR) \cite{jewell2003} compare the odds of $D$ in the exposed and unexposed subgroups to examine their association. Let $\alpha$ and $\beta_i$ respectively be the slope and intercept for variables $X_i$ in a logistic regression model with binary response variable $D$. We can interpret $e^{\beta_i}$ as the OR of $D$ associated with $X_i$, whereas $e^{\alpha}$ represent the odds of $D$ when all observed values for the predictors is zero. According to  \cite{jewell2003}, the OR values for $D$ with binary risk factor $E$ can be interpret as follows: 
\begin{enumerate}
\item OR = 1 suggest independence of $D$ and $E$.
\item OR > 1 suggest there is a greater risk of $D$ when $E$ is present.
\item OR < 1 suggest there is a lower risk of $D$ when $E$ is present.
\end{enumerate}
To estimate the precision of the OR, we used a 95\% confidence interval (CI) \cite{jewell2003, faraway2016}. The interpretation of this intervals is if we repeat the study 100 times (100 sampling from the same population), we would expect the true values of the OR to lie within the derived intervals 95 times.

\subsection{Model Selection}
\label{sec: model selection}
Model \eqref{eq:1} was selected using Akaike information criterion (AIC) and Bayesian information criterion (BIC). The literature we use to give brief explanation about AIC and BIC is \cite{faraway2016}. Let $p$ and $l\left(\hat{\theta}\right)$ be the number of paramterers and maximised log-likelihood in a particular regression model with parameter of interest $\theta$ respectively. We denoted $n$ as the number of observations that we use to fit into this model. The AIC and BIC are defined as follows:
\begin{equation*}
\begin{split}
\textrm{AIC} &= -2l(\hat{\theta})+2p\\
\textrm{BIC} &= -2l(\hat{\theta})+p\log{n}
\end{split}
\end{equation*}
When we compare multiple model using AIC and BIC, we pick the model with the lowest AIC and BIC score. Initially, our first model is Model \eqref{eq:1} with an addition of constituency as random effects intercept and household head gender as fixed effects variable. Table \ref{tab:comparetab} shows that Model \eqref{eq:1} have lower AIC and BIC scores than our first model, which indicates that Model \eqref{eq:1} is better than our first model.
```
```{r comparetab, echo = FALSE, warning = FALSE, message=FALSE}

# Convert test result columns to factor
leptospirosis.dt$result <- factor(leptospirosis.dt$result)


# Fit Binomial GLMM model
model1 <- glmer(result ~ age + altitude + gender +famsize+hhgender+
                  hhage+hhoccup+landuse+(1|genhhid)+(1|village)+
                  (1|constituency),
                family=binomial,leptospirosis.dt[hhjob_index,])

model2 <- glmer(result ~ age + altitude + gender +hhage+famsize+hhoccup+
                  landuse+(1|genhhid)+(1|village),
                family=binomial,leptospirosis.dt[hhjob_index,])

# Model fit comparison table
model_list <- list(model1, model2)
aic_vec <- sapply(model_list, AIC)
bic_vec <- sapply(model_list, BIC)
model_name <- c("I","II")
summary.dt <- data.table(Model = model_name, AIC = aic_vec, BIC = bic_vec)

knitr::kable(summary.dt,"latex",digits=2,
             caption="Results of model comparisons.",booktabs=TRUE) %>%
  kable_styling(position="center",latex_options = "hold_position") 
```

```{=latex}
\subsection{Model Fitting and Diagnostics}
\label{sec: fitting and diagnostics}
We fitted  the data in Section \ref{sec:data} to Model \eqref{eq:1} after some data preparation in Section \ref{sec: eda} and \ref{sec: considerations}. The middle and lower plot in Figure \ref{fig:randomdiag} exhibits the diagnostic plots to check the normality assumptions for the random effects terms in Model \eqref{eq:1}. The lower plot shows that the distribution of the random effects of village is approximating a normal distribution. As for the middle plot, it suggest that the distribution of the random effects of household is approximating a normal distribution although it is slightly right-skewed as the histogram sugessted.
\par
We used the binned residuals plot \cite{gelman2007data} to examine the residual patterns in our fitted values for Model \eqref{eq:1}. The fitted values in this report represent the predicted probability of testing positive for leptospirosis. As \cite{gelman2007data} suggests, we divide the data in this report into categories (bins) based on their fitted values and then plot the average fitted values versus the average residuals for each bin, which can be seen at the upper plot in Figure \ref{fig:randomdiag}. The grey line represents the $\pm$ 2 standard error bounds, within which approximately 95\% of the binned residuals would fall if Model \eqref {eq:1} were true. Overall, most of the fitted values lies within the standard error bounds, which indicates that Model \eqref {eq:1} looks reasonable.
```
```{r randomdiag, message = FALSE, warning = FALSE, echo = FALSE, fig.width = 7, fig.height=8, fig.cap="Some model diagnostic plots for leptospirosis test results prediction model."}

# Extract random intercepet for best model
ranef_param <- ranef(model2,condVar=TRUE)

for (i in 1:length(ranef_param)){
  colnames(ranef_param[[i]]) <- "Intercept"
}

# Diagnostic plot for best model
layout( matrix(c(1,1,2,3,4,5), nrow=3, byrow=TRUE) )

binnedplot(fitted(model2),residuals(model2,type="response"),
           xlab="Expected probability of testing positive for leptospirosis")

hist(ranef_param$genhhid$Intercept,prob=TRUE,xlab= "Random effect of household",
     main="Histogram for Random Effect of Household")
lines(density(ranef_param$genhhid$Intercept),col="red")

qqnorm(ranef_param$genhhid$Intercept,
       main = "Normal Q-Q Plot for Random Effect of Household")
qqline(ranef_param$genhhid$Intercept,col="red")

hist(ranef_param$village$Intercept,prob=TRUE,xlab= "Random effect of village",
     main="Histogram for Random Effect of Village")
lines(density(ranef_param$village$Intercept),col="red")

qqnorm(ranef_param$village$Intercept,
       main = "Normal Q-Q Plot for Random Effect of Village")
qqline(ranef_param$village$Intercept,col="red")
```

```{=latex}
\clearpage
```
```{=latex}
\section{Results}
\label{sec:results}

Model \eqref{eq:1} was fitted with data from Section \ref{sec: fitting and diagnostics}, and Table \ref{tab:ortab} displays the estimated odds ratios for leptospirosis seropositivity (tested positive for leptospirosis) \cite{cook357} associated with the fixed effects predictor variables in Model \eqref{eq:1}, along with their 95\% CI and p-value \cite{jewell2003}. We consider the variable with p-value < 0.05 were significantly associated with leptospirosis seropositivity. Overall, only variable related with land use that is not significantly associated with leptospirosis seropositivity.
```
```{r ortab, echo=FALSE, message=FALSE, warning=FALSE,, results = 'asis', tab.cap="Results of Binomial GLMM analysis for leptospirosis seropositivity."}
# Binomial GLMM estimated Odds Ratio table
list_label <- list(age ~ "Age of the sampled person", altitude ~ "Village altitude",
                   gender ~ "Gender of the sampled person", famsize ~ "Family size",
                   hhage ~ "Age of the household head", landuse ~ "Land use",
                   hhoccup ~"Household head occupation")
or.tbl <- tbl_regression(model2,exponentiate=TRUE,
               estimate_fun = partial(style_ratio, digits = 4), label=list_label) 
or.tbl <- modify_header(or.tbl,label = "**Variable**") 
or.tbl <- as_flex_table(or.tbl)
or.tbl
```

```{=latex}
Based on Table \ref{tab:ortab}, risk factors that were significant for leptospirosis seropositivity were: increasing individual age (OR 1.0064; 95\%CI 1.0033 to 1.0096), increasing family size (OR 1.0366; 95\%CI 1.0332 to 1.0401), and household head working as a pastoralist (OR 5.8191; 95\%CI 1.8675 to 18.132). Protective factors that were significant for leptospirosis seropositivity were: male individual (OR 0.6173; 95\% CI 0.4348 to 0.8766), increasing village altitude (OR 0.989; 95\% CI 0.986 to 0.992), and increasing household head age (OR 0.991; 95\% CI 0.988 to 0.995). 
\clearpage
```
```{=latex}
\section{Conclusion}
\label{sec:conclusion}

Based on the findings in Section \ref{sec:results}, we can conclude that individuals who live in a large family, live or have contact with their household head who works as a pastoralist, are older, belong to a female individual, live in a lower-altitude village, and live or have contact with a younger household head, particularly the household head who is still of working age, are more likely to be seropositive to leptospirosis.
\par
This report has two shortcomings. The first limitation of this analysis is that we were unable to include variables with more missing data in our model, such as location, presence of livestock at home, distance from household to local hospital, and sampled individual's occupation. Despite our efforts to account for this variable, the model produces results in which almost all of the variables in the model are not significantly associated with leptospirosis seropositivity.
\par
The second limitation of this analysis is that we were unable to compare the risk factors associated with all different occupation variables (individual or household head occupations) because some occupations had fewer workers recorded in the data. Although we attempted to include almost all occupations in the data, this caused the model to produce results indicating that almost all occupations had no significant effect on leptospirosis seropositivity due to lower sample sizes in some occupation categories. As a result of reducing the number of occupation variables, we can only compare the risk factors for leptospirosis seropositivity between small occupational categories.
\clearpage

%the entries have to be in the file literature.bib
\bibliography{literature}
\clearpage

\appendix
\section*{Appendices}
\addcontentsline{toc}{section}{Appendices}

\section{Acronyms}
\label{app:one}
We use this following acronyms in the missing data pattern plot in Section \ref{sec: ida}:
\begin{itemize}
\item sampleid: id of the aliquote tested generated at biorepository
\item result: ELISA test results (positive or negative) of the person sampled
\item parent: id of the tube which the aliquote was taken from
\item relationshiphh: relationship of the person sampled with household head
\item gender: gender of the person sampled
\item occupation: occupation of the person sampled
\item age: age of the person sampled
\item landuse: characterization of sampling site based on land use
\item date: date of sampling
\item altitude: altitude of the village where the sample was collected
\item hhgender: gender of the household head
\item hhage: age of the household head
\item hhoccup: occupation of the household head
\item nmales: number of males in the household sampled
\item nfemales: number of females in the household sampled
\item famsize: number of people in the household sampled
\item disthosp: distance from household to local hospital
\item $\text{livestk\char`_home}$: livestock ownership (yes or no) at the sampled person household
\item genhhid: generated household id
\item village: village (anonymised) where the person sampled comes from
\item location: location (anonymised) where the person sampled comes from
\item constituency: constituency where the sampling was collected
\end{itemize}
```
```{=latex}
\section{R Package}
\label{app:two}
We provide a brief explanation about the \verb|R| \cite{rstudio} packages that was used in this reports. For reading the data into \verb|R|, we used \verb|readxl| \cite{rreadxl} package. The data cleaning and manipulation process was done using the \verb|dplyr| \cite{rdplyr} and \verb|data.table| \cite{rdatatable} packages. Plots were created with \verb|arm| \cite{rarm}, \verb|ggplot2| \cite{rggplot2}, \verb|naniar| \cite{rnaniar}, \verb|JointAI| \cite{rjointai}, \verb|ggpubr| \cite{rggpubr} and \verb|patchwork| \cite{rpatchwork} packages. Binomial GLMM models were fitted using \verb|lme4| \cite{bates2015}. Regression tables were created using \verb|gtsummary| \cite{sjoberg2021}, \verb|knitr| \cite{rknitr} and \verb|kableExtra| \cite{rkableextra}. Note that \verb|ggplot2| and \verb|dplyr| are available in \verb|tidyverse| \cite{rtidyverse} package.
```
